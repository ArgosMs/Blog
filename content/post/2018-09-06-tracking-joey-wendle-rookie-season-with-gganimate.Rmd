---
title: Tracking Joey Wendle's rookie season with gganimate
author: Tyler Bradley
date: '2018-09-06'
slug: tracking-joey-wendle-rookie-season-with-gganimate
categories:
  - R
tags:
  - rstats
  - tidyverse
  - mlb
  - gganimate
  - baseballr
description: ''
topics: []
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  warning = FALSE,
  message = FALSE,
  echo = TRUE
)

```

# Introduction
This past weekend I got the chance to go to the Tampa Bay Rays vs Cleveland Indians game. This game was a ton of fun, made even more exciting for me - and by the end of the game, the people in my section - because my brother-in-law's brother (does that make him my brother-in-law too? No one ever knows for sure...), Joey Wendle, plays for the Rays! In case you haven't been paying attention, Joey has been having a ***MASSIVE*** rookie season. Just take a look at some of the tweets from the Ray's organization in the last few days. 
<blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">The AL&#39;s top-hitting rookie is on a record pace.<a href="https://twitter.com/hashtag/RaysUp?src=hash&amp;ref_src=twsrc%5Etfw">#RaysUp</a> <a href="https://t.co/2oo88IXS2f">pic.twitter.com/2oo88IXS2f</a></p>&mdash; Tampa Bay Rays (@RaysBaseball) <a href="https://twitter.com/RaysBaseball/status/1037098037120823297?ref_src=twsrc%5Etfw">September 4, 2018</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>


<blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">How many ways can one man impact a game?<a href="https://twitter.com/hashtag/RaysUp?src=hash&amp;ref_src=twsrc%5Etfw">#RaysUp</a> <a href="https://t.co/iE3izrtc70">pic.twitter.com/iE3izrtc70</a></p>&mdash; Tampa Bay Rays (@RaysBaseball) <a href="https://twitter.com/RaysBaseball/status/1036398948502695937?ref_src=twsrc%5Etfw">September 2, 2018</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>


As you can see, the man has been getting it done at the plate and in the field. This has led some to call for his inclusion in the AL Rookie of the Year conversation. 

<blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr"><a href="https://twitter.com/hashtag/Rays?src=hash&amp;ref_src=twsrc%5Etfw">#Rays</a> Joey Wendle put on a show on Sunday and itâ€™s time to start talking about him as a legit AL Rookie of the Year contender: <a href="https://t.co/G9sFvLLeLq">https://t.co/G9sFvLLeLq</a></p>&mdash; Juan Toribio (@juanctoribio) <a href="https://twitter.com/juanctoribio/status/1036449226732064773?ref_src=twsrc%5Etfw">September 3, 2018</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>


I have been looking for a good excuse to play around with [Thomas Pedersen's](https://www.data-imaginist.com/) [`gganimate`](https://github.com/thomasp85/gganimate) package, and what better way then by taking a look at Joey's rookie season. 

Before we start, let's load the R packages that we will use. 

```{r load-packages}
library(tidyverse)
library(baseballr)
# devtools::install_github("thomasp85/gganimate")
library(gganimate)
library(lubridate)
library(fuzzyjoin) # for position graph
```

# Getting the data
There are several sources of MLB data available on the internet, and the [`baseballr`](https://github.com/BillPetti/baseballr) package by [Bill Petti](https://billpetti.github.io/) makes getting this data super easy. The sources of data that I will use in this post is from the [Baseball Savant](http://baseballsavant.mlb.com) website for batting data and [Fan Graphs](https://www.FanGraphs.com) . These sites both provide game by game data for any player in the league for any season. The Baseball Savant site provides pitch by pitch data about each of Joey's at-bats and the Fan Graphs site provides game by game stats. 

`baseballr`




```{r}
joey_savant <- scrape_statcast_savant_batter(start_date = "2018-03-29", end_date = Sys.Date(), batterid = "621563")

joey <- baseballr::batter_game_logs_fg("13853", year = 2018)

gleyber <- scrape_statcast_savant_batter(start_date = "2018-03-29", end_date = Sys.Date(), batterid = "650402")
andujar <- scrape_statcast_savant_batter(start_date = "2018-03-29", end_date = Sys.Date(), batterid = "609280")
  

position_loc <- tribble(
  ~position, ~x, ~y, 
  "2B", 145, -145,
  "3B", 100, -160,
  "SS", 111, -144,
  "LF", 80, -100,
  "RF", 176, -100
)
  
joey %>% 
  fuzzyjoin::regex_left_join(position_loc, by = c("Pos" = "position")) %>% 
  mutate(Date = lubridate::ymd(Date)) %>% 
  ggspraychart(x_value = "x", y_value = "y", fill_value = "position") + 
  scale_fill_manual(values = c("2B" = "red", "3B" = "blue",
                               "SS" = "green", "LF" = "yellow", 
                               "RF" = "black"), na.translate = FALSE) + 
  labs(title = "Joey Wendle 2018 position by game:{frame_time}") + 
  transition_time(Date) + 
  theme(
    legend.title = element_blank(),
    plot.title = element_text(size = 14),
    plot.caption = element_text(size = 10, face = "bold"),
    legend.text = element_text(size = 12, face = "bold")
  )

savant_daily <- function(data, team){
  output <- data %>% 
    filter(!is.na(events), events != "caught_stealing_2b") %>% 
    mutate(
      rbi = if_else(home_team == team, 
                    post_home_score - home_score,
                    post_away_score - away_score),
      is_ab = if_else(
        events %in% c("strikeout", "field_out", "single", "double", "force_out", 
                      "triple", "home_run", "double_play", "field_error", "grounded_into_double_play",
                      "strikeout_double_play", "fielders_choice_out"),
        TRUE,
        FALSE
      ),
      is_hit = if_else(
        events %in% c("single", "double", "triple", "home_run"), TRUE, FALSE
      ),
      bases = case_when(
        events == "single" ~ 1,
        events == "double" ~ 2,
        events == "triple" ~ 3,
        events == "home_run" ~ 4,
        TRUE ~ 0
      ),
      event_custom = case_when(
        events %in% c("single", "double", "triple", "home_run") ~ events, 
        str_detect(events, "sac") ~ "sacrifice",
        events %in% c("walk", "hit_by_pitch") ~ NA_character_,
        events == "field_error" ~ "error",
        TRUE ~ "out"
      )
    ) %>% 
    group_by(game_date) %>% 
    summarize(
      pa = length(unique(at_bat_number)),
      ab = sum(is_ab),
      hits = sum(is_hit),
      doubles = sum(events == "double"),
      triples = sum(events == "triples"),
      home_runs = sum(events == "home_run"),
      rbi = sum(rbi),
      bb = sum(events == "walk"),
      hbp = sum(events == "hit_by_pitch"),
      so = sum(events %in% c("strikeout", "strikeout_double_play")),
      bases = sum(bases)
    ) %>% 
    arrange(game_date) %>% 
    mutate(
      ba = round(hits/ab, 3),
      obp = round((hits + bb + hbp)/(ab + bb + hbp), 3),
      slg = round(bases/ab, 3),
      ops = obp + slg,
      hits_to_date = cumsum(hits),
      rbis_to_date = cumsum(rbi),
      bb_to_date = cumsum(bb),
      hbp_to_date = cumsum(hbp),
      ab_to_date = cumsum(ab),
      bases_to_date = cumsum(bases),
      ba_to_date = round(hits_to_date/ab_to_date, 3),
      obp_to_date = round(
        (hits_to_date + bb_to_date + hbp_to_date)/(ab_to_date + bb_to_date + hbp_to_date), 3
      ),
      slg_to_date = round(bases_to_date/ab_to_date, 3),
      ops_to_date = obp_to_date + slg_to_date
    )
  
  return(output)
}

joey_savant_daily <- joey_savant %>% 
  savant_daily("TB")


joey_savant_daily %>% 
  ggplot(aes(game_date, ba_to_date)) + 
  geom_line() + 
  theme_bw() + 
  transition_reveal(id = game_date, along = game_date) + 
  geom_text()

joey_savant %>% 
  filter(events %in% c("single", "double", "triple", "home_run")) %>% 
  ggspraychart(fill_value = "events", fill_palette = c("single"="#A2C8EC", "double"="#006BA4", 
                                                       "triple"="#FF940E", "home_run"="#C85200")) + 
  scale_fill_manual(values = c("single"="#A2C8EC", "double"="#006BA4", 
                               "triple"="#FF940E", "home_run"="#C85200"),
                    labels = c("single", "double", "triple", "home run")) + 
  labs(title = "Joey Wendle 2018 hits to date: {frame_time}",
       caption = "Data source: baseballsavant.com\nBuilt with the baseballr package\n") + 
  transition_reveal(game_date, game_date) + 
  theme(
    legend.title = element_blank(),
    plot.title = element_text(size = 14),
    plot.caption = element_text(size = 10, face = "bold"),
    legend.text = element_text(size = 12, face = "bold")
  )



gleyber_daily <- gleyber %>% 
  savant_daily()

andujar_daily <- andujar %>% 
  savant_daily()

combined_daily <- joey_savant_daily %>% 
  mutate(player = "Joey Wendle") %>% 
  bind_rows(
    gleyber_daily %>% 
      mutate(player = "Gleyber Torres"),
    andujar_daily %>% 
      mutate(player = "Miguel Andujar")
  )


ba_comparison <- combined_daily %>% 
  ggplot(aes(game_date, ba_to_date, color = player)) + 
  geom_step(size = 1) +
  labs(title = "Batting Average by date: {frame_time}") + 
  theme_bw() + 
  transition_reveal(id = player, along = game_date)

gganimate::animate(ba_comparison, width = 1000, height = 800)


stats_comparison <- combined_daily %>% 
  group_by(player) %>% 
  mutate(doubles_to_date = cumsum(doubles),
         # triples_to_date = cumsum(triples),
         homers_to_date = cumsum(home_runs)) %>%
  select(player, game_date, contains("to_date")) %>% 
  gather(key = "metric", value = "value", contains("to_date")) %>% 
  ggplot(aes(game_date, value, color = player)) + 
  facet_wrap(vars(metric), scales = "free_y") + 
  geom_path() + 
  theme_bw() + 
  labs(title = "2018 player stats by day: {frame_time}") +
  transition_reveal(player, game_date)

animate(stats_comparison, width = 1000, height = 800)




```